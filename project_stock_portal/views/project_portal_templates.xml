<?xml version="1.0" encoding="utf-8" ?>
<!-- Copyright 2023 Manuel Regidor <manuel.regidor@sygel.es>
 License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl). -->
<odoo>
    <template id="portal_task_stock_table" name="Portal Timesheet Table">
            <table class="table table-sm">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th class="text-end">Quantity</th>
                  </tr>
                </thead>
                <tr t-foreach="materials" t-as="m">
                    <td><t t-esc="m.product_id.name" /></td>
                    <td class="text-end"><t t-esc="m.quantity_done" /> <t
                        t-esc="m.product_uom.name"
                    /></td>
                </tr>
            </table>
    </template>
    <template id="portal_task_stock" inherit_id="project.portal_my_task">
        <xpath expr="//div[@id='card_body']" position="inside">
            <t
                t-set="materials"
                t-value="task.move_ids.filtered(lambda a: a.quantity_done > 0)"
            />
            <t t-if="materials">
                <div class="container" t-if="task.move_ids">
                    <hr class="mt-4 mb-1" />
                    <h5
                        id="task_stock"
                        class="mt-2 mb-2"
                        data-anchor="true"
                    >Materials</h5>
                    <t t-call="project_stock_portal.portal_task_stock_table" />
                </div>
            </t>
        </xpath>
        <xpath expr="//a[@href='#task_timesheets']/.." position="after">
            <t
                t-set="materials"
                t-value="task.move_ids.filtered(lambda a: a.quantity_done > 0)"
            />
            <li t-if="materials" class="nav-item">
                <a class="nav-link ps-3" href="#task_stock">
                    Materials
                </a>
            </li>
        </xpath>
    </template>
</odoo>
