<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright 2023 Manuel Regidor <manuel.regidor@sygel.es>
 License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl). -->
<odoo>
    <template id="project_task_sign_timesheet_sale_page" inherit_id="hr_timesheet.timesheet_project_task_page">
        <xpath expr="//t[@t-if='from_project']" position="after">
            <div t-field="doc.partner_id"
                t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}' />
            <p t-if="doc.partner_id.vat"><t t-out="doc.company_id.account_fiscal_country_id.vat_label or 'Tax ID'"/>: <span t-field="doc.partner_id.vat"/></p>
        </xpath>
        <xpath expr="//t[@t-if='doc.allow_timesheets and doc.timesheet_ids']/../.." position="after">
            <t t-if="doc._name == 'project.task'">
                <t t-set="material_lines" t-value="doc.move_ids.filtered(lambda a: a.quantity_done > 0.0)"/>
                <t t-if="material_lines">
                    <div class="row mt8">
                        <div class="col-12">
                            <h2>
                                <br/>
                                <span>Materials</span>
                            </h2>
                            <table class="table table-sm">
                                <thead>
                                  <tr>
                                    <th style="text-align: left">Name</th>
                                    <th class="text-end">Quantity</th>
                                  </tr>
                                </thead>
                                <tr t-foreach="material_lines" t-as="m">
                                    <td><t t-esc="m.product_id.name"/></td>
                                    <td class="text-end"><t t-esc="m.product_uom_qty"/> <t t-esc="m.product_uom.name"/></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </t>
                <div t-if="doc.signed">              
                    <div class="row mt8" align="right" t-if="doc.signature_img">
                        <div class="col-12">
                            <img t-att-src="image_data_uri(doc.signature_img)" style="width: 320px;"/>
                        </div>
                    </div>
                    <div class="row mt8" align="right" t-if="doc.signature_name">
                        <div class="col-12">
                            <p t-esc="doc.signature_name"/>
                        </div>
                    </div>
                    <div class="row mt8" align="right" t-if="doc.signature_date">
                        <div class="col-12">
                            <p t-field="doc.signature_date" t-options="{'widget': 'datetime', 'format': 'dd/MM/YYYY - hh:mm'}"/>
                        </div>
                    </div>
                </div>
            </t>
        </xpath>
    </template>
</odoo>
